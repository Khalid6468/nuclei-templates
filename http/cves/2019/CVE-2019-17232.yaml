id: cve-2019-17232-ultimate-faqs-combined

info:
  name: WordPress Ultimate FAQ <= 1.8.24 - Version + Exploit Check (CVE-2019-17232)
  author: Khalid6468
  severity: high
  description: |
    Ultimate FAQ (ultimate-faqs) <= 1.8.24 is affected by CVE-2019-17232.
    The template attempts unauthenticated version detection and then confirms
    exploitability by triggering the admin import action and detecting an echoed SQL
    query (requires an authenticated session cookie). Fixed in 1.8.25.
  remediation: Update to Ultimate FAQ 1.8.25 or later.
  reference:
    - https://blog.nintechnet.com/unauthenticated-options-import-vulnerability-in-wordpress-ultimate-faq-plugin/
  classification:
    cve-id: CVE-2019-17232
    cwe-id: CWE-306
    cvss-score: 7.5
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
  metadata:
    vendor: etoilewebdesign
    product: ultimate-faqs
    affected_version: "<= 1.8.24"
  tags: cve,cve2019,wordpress,wp-plugin,ultimate-faq,authenticated

variables:
  admin_path: wp-admin
  cookie: ""

http:
  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/ultimate-faqs/readme.txt"
    redirects: true
    matchers:
      - type: dsl
        dsl:
          - compare_versions(readme_version, "<=", "1.8.24")
    extractors:
      - type: regex
        name: readme_version
        part: body
        regex:
          - "(?mi)^Stable tag:\\s*([0-9.]+)"

  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/ultimate-faqs/Main.php"
    redirects: true
    matchers:
      - type: dsl
        dsl:
          - compare_versions(plugin_version, "<=", "1.8.24")
    extractors:
      - type: regex
        name: plugin_version
        part: body
        regex:
          - "(?mi)^\\s*Version:\\s*([0-9.]+)"

  - method: GET
    path:
      - "{{BaseURL}}/{{admin_path}}/admin.php?page=EWD-UFAQ-Options&DisplayPage=ImportPosts&Action=EWD_UFAQ_ImportFaqs"
    headers:
      Cookie: "{{cookie}}"
    redirects: true
    matchers-condition: and
    matchers:
      - type: status
        status: [200]
      - type: word
        part: body
        words:
          - "SELECT "
          - "SQL_CALC_FOUND_ROWS"
          - "FROM wp_posts"
          - "post_type = 'ufaq'"
        condition: and